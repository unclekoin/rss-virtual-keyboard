(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function n(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,l(e,t,"get"))}function a(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,l(e,t,"set"),i),i}function l(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var r=new WeakMap,s=new WeakMap,o=new WeakMap,c=new WeakMap,d=function(){function l(e){var t=e.tag,n=void 0===t?"div":t,d=e.cls,u=void 0===d?[]:d,p=e.content,h=void 0===p?"":p,v=e.id,f=void 0===v?null:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),i(this,r,{writable:!0,value:void 0}),i(this,s,{writable:!0,value:void 0}),i(this,o,{writable:!0,value:void 0}),i(this,c,{writable:!0,value:void 0}),a(this,r,null),a(this,s,n),a(this,o,u),a(this,c,h),this.id=f,this.create()}var d,u;return d=l,(u=[{key:"element",get:function(){return n(this,r)}},{key:"create",value:function(){var t,i,l=document.createElement(n(this,s));(t=l.classList).add.apply(t,function(t){if(Array.isArray(t))return e(t)}(i=n(this,o))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n(this,c)&&(l.textContent=n(this,c)),this.id&&(l.id=this.id),a(this,r,l)}}])&&t(d.prototype,u),Object.defineProperty(d,"prototype",{writable:!1}),l}();const u=function(e){return new d({tag:"button",cls:["btn","btn-primary"],id:e.split(" ").join(""),content:e}).element},p=JSON.parse('{"ru":[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],"Backspace","Tab","й","ц","у","к","е","н","г","ш","щ","з","х","ъ",["\\\\","|"],"Del","Caps Lock","ф","ы","в","а","п","р","о","л","д","ж","э","Enter","Shift","Backslash","я","ч","с","м","и","т","ь","б","ю","/","8679","Shift","Ctrl","Alt","Space","Alt","Ctrl","8678","8681","8680"],"en":[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],"Backspace","Tab","q","w","e","r","t","y","u","i","o","p",["[","{"],["]","}"],["\\\\","|"],"Del","Caps Lock","a","s","d","f","g","h","j","k","l",";","\'","Enter","Shift","Backslash","z","x","c","v","b","n","m",".",",","/","8679","Shift","Ctrl","Alt","Space","Alt","Ctrl","8678","8681","8680"]}');function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=new d({cls:["keyboard"]}).element,this.display=t,this.isUpper=!1,this.isShift=!1,this.isAlt=!1,this.prevPosition=0,this.lang=localStorage.getItem("keyboardLanguage")||"en",this.virtualHandler(),this.physicalHandler()}var t,i;return t=e,i=[{key:"render",value:function(){var e,t,i,n=this;this.element.innerHTML="",localStorage.setItem("keyboardLanguage",this.lang),p[this.lang].forEach((function(a){var l;if(a.includes("86")){switch(a){case"8679":l=u("ArrowUp");break;case"8681":l=u("ArrowDown");break;case"8678":l=u("ArrowLeft");break;case"8680":l=u("ArrowRight");break;default:return}l.innerHTML="&#".concat(a,";")}else if(a.length>1&&!a.includes("86")&&!Array.isArray(a))(l=u(a)).classList.add("btn-big",a.toLowerCase().split(" ").join("-")),"Del"===a&&(l.id="Delete"),"Shift"===a&&e&&(l.id="ShiftRight",l.classList.add("second"),n.isShift?l.classList.add("active"):l.classList.remove("active")),"Shift"===a&&(e=!0,n.isShift?l.classList.add("active"):l.classList.remove("active")),"Ctrl"===a&&t&&(l.id="ControlRight"),"Ctrl"===a&&(t=!0),"Alt"===a&&i&&(l.id="AltRight"),"Alt"===a&&(i=!0),"Caps Lock"===a&&(n.isUpper?l.classList.add("active"):l.classList.remove("active")),"Backslash"===a&&(l.innerHTML="\\");else{var r=Array.isArray(a)?a[n.isShift?1:0]:a;l=n.isUpper?u(r.toUpperCase()):u(r)}n.element.append(l)}))}},{key:"virtualHandler",value:function(){var e=this;this.element.addEventListener("click",(function(t){var i,n=t.target;e.isArrow=!1;var a=e.display.selectionStart,l=e.display.selectionEnd,r=0,s=function(e,t){for(var i=t.split("\n"),n=0,a=0,l=0;l<i.length;l++)if((n+=i[l].length)+l+1>e){a=l;break}return{array:i,rowIndex:a,colIndex:e-(n-i[a].length+a),displayLength:t.length}}(a,e.display.value),o=s.colIndex,c=s.rowIndex,d=s.array;if((o||d[c])&&(e.prevPosition=o),!n.className.includes("keyboard")){if(n.id.length>1)switch(n.id){case"CapsLock":e.isUpper=!n.className.includes("active"),e.render({isUpper:e.isUpper});break;case"Space":e.display.value+=" ";break;case"Enter":e.display.value+="\n";break;case"Tab":e.display.value+="\t";break;case"Backspace":var u=a===l&&a?a-1:a;e.display.value=e.display.value.slice(0,u)+e.display.value.slice(l),e.display.setSelectionRange(u,u);break;case"Delete":e.display.value=e.display.value.slice(0,a)+e.display.value.slice(l===a?l+1:l),e.display.setSelectionRange(a,a);break;case"Shift":case"ShiftRight":e.isShift=!n.className.includes("active"),e.render();break;case"Alt":if(!e.isShift)return;e.lang="en"===e.lang?"ru":"en",e.render();break;case"Backslash":e.display.value+="\\";break;case"Ctrl":default:return;case"ArrowUp":if(""===d[c-1])r=a-o-1;else if(o||void 0===d[c-1])if(d[c-1]&&d[c-1].length>=d[c].length)r=a-(d[c].length+1)-(d[c-1].length-d[c].length);else{var p,h;r=o>(null===(p=d[c-1])||void 0===p?void 0:p.length)?a-o-1:a-((null===(h=d[c-1])||void 0===h?void 0:h.length)+1)}else r=e.prevPosition>d[c-1].length?a-1:a-d[c-1].length-1+e.prevPosition;e.display.setSelectionRange(r,r);break;case"ArrowDown":r=""===d[c+1]?a+(d[c].length-o)+1:o||void 0===d[c+1]?o>=(null===(i=d[c+1])||void 0===i?void 0:i.length)?a+d[c+1].length-d[c].length-o:a+(d[c].length-o)+o+1:!o&&d[c]?a+d[c].length+1:e.prevPosition>d[c+1].length?a+d[c+1]+1:a+e.prevPosition+1,e.display.setSelectionRange(r,r);break;case"ArrowLeft":a&&a--,e.display.setSelectionRange(a,a);break;case"ArrowRight":a++,e.display.setSelectionRange(a,a)}else e.display.value+=n.id;e.display.focus()}}))}},{key:"physicalHandler",value:function(){var e=this,t=["ShiftRight","ControlRight","AltRight","Space"];document.addEventListener("keydown",(function(i){var n;if(e.display.focus(),e.isShift=i.shiftKey,e.isAlt=i.altKey,e.isUpper=i.getModifierState("CapsLock"),"Shift"===i.key&&e.render(),"CapsLock"===i.key&&e.render(),e.isAlt&&e.isShift&&(e.lang="en"===e.lang?"ru":"en",e.render()),"Tab"===i.key&&(e.display.value+="\t"),"Backslash"!==i.code||e.isShift||null===(n=document.getElementById(i.code))||void 0===n||n.classList.add("active"),t.includes(i.code)){var a;null===(a=document.getElementById(i.code))||void 0===a||a.classList.add("active")}else{var l,r="Control"===i.key?"Ctrl":i.key;null===(l=document.getElementById(r))||void 0===l||l.classList.add("active")}})),document.addEventListener("keyup",(function(i){var n,a;if(e.isShift=i.shiftKey,e.isUpper=i.getModifierState("CapsLock"),"Shift"===i.key&&e.render(),"CapsLock"===i.key&&e.render(),"Backslash"!==i.code||e.isShift||null===(a=document.getElementById(i.code))||void 0===a||a.classList.remove("active"),t.includes(i.code))n=document.getElementById(i.code);else{var l="Control"===i.key?"Ctrl":i.key;n=document.getElementById(l)}n&&n.classList.remove("active")}))}},{key:"keyboard",get:function(){return this.element}}],i&&h(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();const f=v;var y,g,b=new d({cls:["app"]}).element,m=new d({cls:["container"]}).element,k=(y=!0,(g=new d({tag:"button",cls:["theme-toggle"]}).element).innerHTML='<i class="bi bi-brightness-high theme-toggle__icon"></i>',g.addEventListener("click",(function(){document.querySelector(".app").classList.toggle("theme"),y=!y,g.innerHTML=y?'<i class="bi bi-brightness-high theme-toggle__icon"></i>':'<i class="bi bi-moon-fill theme-toggle__icon"></i>'})),g),w=function(){var e=new d({tag:"textarea",cls:["display"]}).element;return e.setAttribute("inputmode","none"),e}(),S=new f(w);window.addEventListener("load",(function(){b.append(m),S.render(),m.innerHTML="",m.append(k,w,S.keyboard),w.focus(),w.focus()}));const L=b;var A=document.body,C=new d({tag:"div",cls:["overlay"]}).element,E=function(){var e=new d({tag:"div",cls:["popup"]}).element;return e.innerHTML='\n    <div>\n        <button class="popup__btn">&times;</button>\n        <h3>Дорогие коллеги!</h3>\n        <ol>\n          <li>Клавиатура разрабатывалась на <code>macOS</code></li>\n          <li><span>Начальное состояние:</span>\n            <ul>\n              <li>язык физической клавиатуры английский</li>\n              <li><code>Caps Lock</code> выключен</li>\n            </ul>\n          </li>\n          <li>Для смены языка нажмите <code>Shift + Alt</code> или <code>Shift + Option</code></li>\n          <li>Клавиша <code>Caps Lock</code> переключает регистр</li>\n          <li>Клавиша <code>Shift</code> переключает цифры и символы</li>\n          <li>\n          Виртуальная клавиатура реагирует на нажатие клавиш физической клавиатуры \n          если символы, язык и регистр совпадают\n          </li>\n          <li>Для повторного отображения этого сообщения перезагрузите страницу</li>\n        </ol>\n      </div>\n    ',e}(),T=E.querySelector(".popup__btn");A.append(L,C,E),T.addEventListener("click",(function(){A.classList.add("popup-close")})),C.addEventListener("click",(function(){A.classList.add("popup-close")}))})();